# Advanced CDN - Sample Environment Configuration
# Copy this file to .env and customize for your deployment

# ============================================
# SERVER CONFIGURATION
# ============================================
PORT=8080
HOST=0.0.0.0
NODE_ENV=production
TRUST_PROXY=true

# ============================================
# CLUSTERING (Multi-process support)
# ============================================
ENABLE_CLUSTER=false
CLUSTER_WORKERS=4

# ============================================
# SSL/HTTPS CONFIGURATION
# ============================================
ENABLE_SSL=false
SSL_CERT_PATH=./ssl/cert.pem
SSL_KEY_PATH=./ssl/key.pem
SSL_PASSPHRASE=
HTTP_TO_HTTPS_REDIRECT=true

# ============================================
# CDN CONFIGURATION
# ============================================

# Dynamic Hostname Mode (NEW FEATURE)
# When enabled, accepts requests from ANY hostname
# Each hostname maintains its own identity as the origin domain
USE_DYNAMIC_HOSTNAME=true

# Static Domain Configuration (used when USE_DYNAMIC_HOSTNAME=false)
ORIGIN_DOMAIN=allabout.network
TARGET_DOMAIN=main--allaboutv2--ddttom.hlx.live
TARGET_HTTPS=true
CDN_NAME=advanced-cdn-proxy

# Domain Validation (ignored when USE_DYNAMIC_HOSTNAME=true)
STRICT_DOMAIN_CHECK=false
ADDITIONAL_DOMAINS=

# ============================================
# PATH REWRITING (Works with dynamic hostnames)
# ============================================
PATH_REWRITE_ENABLED=false
# Format: domain1:/prefix1,domain2:/prefix2
DOMAIN_PATH_MAPPING=

# ============================================
# CACHE CONFIGURATION
# ============================================
CACHE_ENABLED=true
CACHE_DEFAULT_TTL=300
CACHE_MAX_TTL=3600
CACHE_CHECK_PERIOD=120
CACHE_MAX_ITEMS=1000
RESPECT_CACHE_CONTROL=true
CACHE_COOKIES=false
CACHEABLE_CONTENT_TYPES=text/html,text/css,text/javascript,application/javascript,application/json,image/jpeg,image/png,image/gif,image/webp,image/svg+xml
CACHEABLE_STATUS_CODES=200,301,302,304

# ============================================
# SECURITY CONFIGURATION
# ============================================
SECURITY_HEADERS=true
CONTENT_SECURITY_POLICY=
ENABLE_CORS=false
CORS_ORIGINS=*

# Rate Limiting
RATE_LIMIT_ENABLED=false
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX=100

# ============================================
# LOGGING CONFIGURATION
# ============================================
LOG_LEVEL=info
LOG_FORMAT=combined
ACCESS_LOG_ENABLED=true
ERROR_LOG_ENABLED=true
LOG_DIR=./logs
LOG_TO_CONSOLE=true
LOG_TO_FILE=true

# ============================================
# PERFORMANCE CONFIGURATION
# ============================================
ENABLE_COMPRESSION=true
COMPRESSION_LEVEL=6
COMPRESSION_MIN_SIZE=1024
MAX_BODY_SIZE=1mb
REQUEST_TIMEOUT=30000

# ============================================
# MONITORING CONFIGURATION
# ============================================
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_PATH=/health
HEALTH_CHECK_DETAILED=false
METRICS_ENABLED=true
METRICS_PATH=/metrics

# ============================================
# FILE RESOLUTION (Optional)
# ============================================
FILE_RESOLUTION_ENABLED=false
FILE_RESOLUTION_DEFAULT_EXTENSIONS=html,md,json,csv,txt
FILE_RESOLUTION_TIMEOUT=5000
FILE_RESOLUTION_MAX_CONCURRENT=10
FILE_RESOLUTION_RETRY_ATTEMPTS=2
FILE_RESOLUTION_RETRY_DELAY=1000
FILE_RESOLUTION_CACHE_ENABLED=true
FILE_RESOLUTION_CACHE_TTL=300
FILE_RESOLUTION_TRANSFORMERS_ENABLED=true

# ============================================
# URL TRANSFORMATION (Optional)
# ============================================
URL_TRANSFORM_ENABLED=false
URL_TRANSFORM_HTML=true
URL_TRANSFORM_JS=true
URL_TRANSFORM_CSS=true
URL_TRANSFORM_INLINE_STYLES=true
URL_TRANSFORM_DATA_ATTRS=true
URL_PRESERVE_FRAGMENTS=true
URL_PRESERVE_QUERY=true
URL_TRANSFORM_MAX_SIZE=52428800
URL_TRANSFORM_CACHE_SIZE=10000
URL_TRANSFORM_DEBUG=false
URL_TRANSFORM_CONTENT_TYPES=text/html,application/xhtml+xml,text/javascript,application/javascript,application/x-javascript,text/css

# ============================================
# QUICK START EXAMPLES
# ============================================

# Example 1: Dynamic Hostname with Single Backend
# USE_DYNAMIC_HOSTNAME=true
# TARGET_DOMAIN=backend.example.com
# Result: Any hostname → backend.example.com

# Example 2: Dynamic Hostname with Path Rewriting
# USE_DYNAMIC_HOSTNAME=true
# PATH_REWRITE_ENABLED=true
# DOMAIN_PATH_MAPPING=api.site.com:/api,blog.site.com:/blog
# Result: api.site.com/users → backend.com/api/users
#         blog.site.com/post → backend.com/blog/post
#         other.com/page → backend.com/page

# Example 3: Static Domain Configuration
# USE_DYNAMIC_HOSTNAME=false
# ORIGIN_DOMAIN=mysite.com
# ADDITIONAL_DOMAINS=www.mysite.com,cdn.mysite.com
# TARGET_DOMAIN=backend.mysite.com
# Result: Only configured domains accepted